
# 중앙대학교 예술공학대학 2023-2 인공지능과 머신러닝 과제# 2

# 문제

- 본 문제의 목표는 주어진 인체 치수 데이터를 이용하여 **성별**을 분류하는 것입니다.
- 사용할 수 있는 인체 치수의 개수에는 제한이 없습니다.
- `classification.py`에 머신러닝 모델을 구현합니다.
- 사용할 수 있는 외부 Python 패키지(3rd-party package)는 `numpy`, `scipy`, `pandas`, `scikit-learn` 입니다.

  즉, `xgboost`, `tensorflow`, `pytorch`와 같은 외부 프레임워크는 사용할 수 없습니다.

- 문제 번호에 따라 분류 모델의 클래스 이름을 정의해야 합니다.

  예를 들어, 문제(1)의 모델 클래스 이름은 반드시 `Model01`로 정의해야 합니다.

  본 과제에는 문제(1) 하나 밖에 없기 때문에 `Model01` 클래스만 정의하면 됩니다.

- 본 과제에서 분류 결과의 평가 척도는 [Accuray](https://en.wikipedia.org/wiki/Evaluation_of_binary_classifiers#Single_metrics), [ROC-AUC](https://en.wikipedia.org/wiki/Receiver_operating_characteristic), [PR-AUC](https://en.wikipedia.org/wiki/Precision_and_recall)를 사용합니다.

  평가 척도를 계산하기 위해 `scikit-learn`에서 제공하는 함수를 이용할 수 있습니다.

  모델 성능의 최종 평가 척도는 Accuracy, ROC-AUC, PR-AUC의 합으로 정의됩니다.

  ```

  Metric :=  Accuracy + ROC-AUC + PR-AUC

  ```

# 접근


## 제출 테스트


과제에서 제공된 예제 코드를 분석하고 실험 제출

![Pasted_image_20231206160648.png](/assets/images/Pasted_image_20231206160648.png)

```python
import numpy as np
import pandas as pd
from sklearn.naive_bayes import GaussianNB

class ClassificationModel:
    def __init__(self):
        self._model = None

	@property
    def features(self):
        return self._features

    def train(self, df):
        X = df[self._features]
        y = df["성별"]
        self._model.fit(X, y)

    def predict(self, df):
        X = df[self._features]
        pred = self._model.predict(X)
        return pred

class Model01(ClassificationModel):
    def __init__(self):
        self._model = GaussianNB()
        self._features = [
            "눈높이",
            "목뒤높이",
            "손목둘레"
        ]
```


코드의 특징은 다음과 같다.

- Classification.py 코드는 분류 모델을 구현하는 ClassificationModel 클래스와 이 클래스의 하위 클래스로 구성된다.
- ClassificationModel 클래스는 학습 모델, 피쳐를 가지고 이는 하위 클래스에서 정의된다.
- ClassificationModel 클래스는 훈련 데이터와 주어진 피쳐를 통해 모델을 피팅하는 train 메소드와 피팅된 모델을 통해 분류를 수행하는 predict 메소드를 가진다.

과제 수행을 위해 다음 작업이 요구됨

1. Model01 클래스의 Model 설정
2. Model01 클래스의 Features 설정

이 작업 외에 별도로 코드를 수정하는 작업이 크게 불필요할 것으로 예상됨


테스트 코드는 Gaussian Naive Bayes 모델, 피쳐의 요소로 '눈높이, 목뒤높이, 손목둘레'를 사용했으며 이 분류 모델의 결과는 다음과 같다.

```
[Model#01] Acc: 0.896054
[Model#01] ROC-AUC: 0.895494
[Model#01] PR-AUC: 0.862413
```

```
[2023-12-06 16:03:12] 
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.696793 (Acc: 0.911, ROC-AUC: 0.910, PR-AUC: 0.876)



- Metric: 2.69679300
- Rank: 40
- Score: 60.0

```

모델에서 피쳐를 임의 값으로 변경했을 때 결과는 다음과 같다.

```
self._features = [
	"어깨높이",
	"손직선길이",
	"발너비"
]

[Model#01] Acc: 0.878436
[Model#01] ROC-AUC: 0.877809
[Model#01] PR-AUC: 0.841346
```

피쳐의 변경을 통한 모델 수정이 정상적으로 적용됐다.



12/06 16:34 현재 1등의 점수는 다음과 같다.

```
- [ASSIGNMENT_02 (2023-12-05 21:21:40)] 20213715 has submitted..! (💡Metric: 2.99571e+00 🏅Rank: 1 🔥Score: 100.0)
```

과제의 평가 척도인 Acc, ROC-AUC, PR-AUC가 모두 1에 근접하고 있다.

즉, 분류 모델이 거의 완벽하게 분류를 수행할 수 있어야 고득점을 달성할 수 있다.


## 접근 과정


### 사전 접근

예상되는 요소

- 단일 요소의 집합으로는 한계가 있을 것
- 요소의 개수가 과도하게 많으면 오히려 정확도가 떨어질 것
- 각종 수치를 적절하게 합성해야 좋은 결과가 나올 것

제공된 수치 목록 (성별 제외 111개 요소)

성별, 
키, 눈높이, 목뒤높이, 어깨높이, 어깨가쪽높이, 
겨드랑높이, (팔굽힌)팔꿈치높이, 엉덩이높이, 주먹높이, 허리높이, 
배꼽수준허리높이, 위앞엉덩뼈가시높이, 정강뼈위점높이, 샅높이, 허리너비, 
배꼽수준허리너비, 엉덩이너비, 겨드랑두께, 허리두께, 배꼽수준허리두께, 
엉덩이두께, 몸통수직길이, 엉덩이수직길이, 체중(몸무게), 앞중심길이, 
배꼽수준앞중심길이, 겨드랑앞벽사이길이, 겨드랑앞접힘사이길이, 목둘레, 목밑둘레, 
허리둘레, 배꼽수준허리둘레, 배둘레, 엉덩이둘레, 배돌출점기준엉덩이둘레, 
어깨길이, 목뒤등뼈위겨드랑수준길이, 등길이, 배꼽수준등길이, 넙다리직선길이, 
어깨사이길이, 어깨가쪽사이길이, 겨드랑뒤벽사이길이, 겨드랑뒤접힘사이길이, 위팔길이(어깨점), 
팔길이, 팔안쪽길이, 겨드랑둘레, 엉덩이옆길이, 다리가쪽길이, 
몸통세로둘레, 샅앞뒤길이, 배꼽수준샅앞뒤길이, 앉은키, 앉은눈높이, 
앉은목뒤높이, 앉은어깨높이, 앉은팔꿈치높이, 앉은넙다리높이, 앉은무릎높이, 
앉은오금높이, 앉은엉덩이무릎수평길이, 앉은엉덩이오금수평길이, 앉은엉덩이배두께, (팔굽힌)위팔수직길이, 
(팔굽힌)아래팔수평길이, (팔굽힌)팔꿈치손끝수평길이, (팔굽힌)팔꿈치주먹수평길이, 앉은배두께, 어깨너비, 
위팔사이너비, 팔꿈치사이너비, 앉은엉덩이너비, 머리수직길이, 얼굴수직길이/코뿌리-턱끝수직길이, 
벽면앞으로뻗은주먹수평길이, 벽면어깨수평길이, 눈동자사이너비, 눈구석사이너비, 눈살눈확아래사이수직길이, 
손직선길이, 손바닥직선길이, 손너비/손안쪽가쪽직선길이, 검지손가락길이, 검지손가락중간마디너비, 
검지손가락끝마디너비, 손두께, 막대쥔손안둘레, 손둘레, 머리둘레, 
귀구슬사이머리위길이, 눈살-머리마루-뒤통수길이, 머리두께/눈살-뒤통수돌출직선길이, 머리너비, 얼굴너비, 
아래턱사이너비, 발너비, 발직선길이, 가쪽복사높이, 넙다리둘레, 
넙다리중간둘레, 무릎둘레, 무릎아래둘레, 장딴지둘레, 종아리최소둘레, 
발목최대둘레, 발꿈치너비, (편)위팔둘레, (편)팔꿈치둘레, 손목둘레, 머리위로뻗은주먹높이


### 1차 시도

#### 접근

각 수치를 단일로 사용했을 때 성별을 얼마나 정확하게 예측하는지 살펴본다.

#### 과정

학습 모델 : Gaussian Naive bayes

키와 몸무게 단일 피쳐로 모델 학습 시 결과

```
self._features = [
	"키"
]

[Model#01] Acc: 0.870331
[Model#01] ROC-AUC: 0.869738
[Model#01] PR-AUC: 0.832201
```

```
self._features = [
	"체중(몸무게)"
]

[Model#01] Acc: 0.772375
[Model#01] ROC-AUC: 0.767774
[Model#01] PR-AUC: 0.715875
```


일일이 확인할 수 없으니 ClassificationModel 클래스의 features에 setter를 설정하고 반복문을 통해 각 변수가 성별에 얼마나 관련이 있는지 확인했다.

```python
# Create the classification models.
model = Model01()
arr = []

for col in df_train.columns:
   temp = []
   model.features = [col]
   temp.append(train_and_cal_metrics(model))
   temp.append(col)
   arr.append(temp)

arr.sort()
for a in arr:
    a[0], a[1] = a[1], a[0]
    print(a)
```

```
['Name', (ACC, ROC-AUC, PR-AUC)]
['눈살-머리마루-뒤통수길이', (0.5010570824524313, 0.49706162836732515, 0.5246165891804319)]
['엉덩이너비', (0.5260747004933052, 0.5, 0.5260747004933052)]
['배둘레', (0.5294221282593375, 0.5114729954160306, 0.5318692409835393)]
['벽면어깨수평길이', (0.5443974630021141, 0.5310126314374142, 0.5421383256564478)]
['배꼽수준샅앞뒤길이', (0.5454545454545454, 0.5406220354218074, 0.547641746278011)]
['앉은엉덩이너비', (0.5507399577167019, 0.5496438148783542, 0.5530536988503938)]
['어깨길이', (0.5556730091613813, 0.5764245537415, 0.590210943799006)]
['앉은엉덩이배두께', (0.5576109936575053, 0.5445477905566747, 0.5495339373325798)]
['배꼽수준허리너비', (0.560077519379845, 0.549047849070134, 0.5521242601327824)]
['배돌출점기준엉덩이둘레', (0.5762861169837914, 0.5663693269956203, 0.5621706207732637)]     
['엉덩이옆길이', (0.5776955602536998, 0.5693856335762679, 0.5641053830395872)]
['넙다리둘레', (0.5868569415081043, 0.576711020698825, 0.5683073566540804)]
['엉덩이둘레', (0.5870331219168429, 0.578794722334961, 0.569796992798103)]
['엉덩이두께', (0.5873854827343199, 0.5740994529614035, 0.5664444512871222)]
['앉은배두께', (0.5976039464411558, 0.592968923128254, 0.5793131700288107)]
['막대쥔손안둘레', (0.5983086680761099, 0.5885532733923116, 0.5755892427244614)]
['눈구석사이너비', (0.5984848484848485, 0.5907106770878723, 0.5772550278117534)]
['앉은팔꿈치높이', (0.5986610288935871, 0.5922416132783224, 0.5784745852581801)]
['눈살눈확아래사이수직길이', (0.6060606060606061, 0.5927886518747961, 0.5777018330990502)]   
['겨드랑뒤접힘사이길이', (0.6078224101479915, 0.6243861689121726, 0.6268171877288865)]       
['배꼽수준허리둘레', (0.614693446088795, 0.6079584529539337, 0.5885851068064829)]
['아래턱사이너비', (0.615045806906272, 0.6038343745409183, 0.5849242026187885)]
['목밑둘레', (0.6203312191684285, 0.6357774944785705, 0.6350960324788413)]
['배꼽수준허리두께', (0.6222692036645525, 0.6163195283068198, 0.5943880410968829)]
['겨드랑앞접힘사이길이', (0.6231501057082452, 0.6392121100451426, 0.641460029224824)]        
['눈동자사이너비', (0.6261451726568006, 0.6238543189157829, 0.6010063293048263)]
['팔안쪽길이', (0.6270260747004933, 0.6424906067223249, 0.6426300727275657)]
['배꼽수준앞중심길이', (0.6280831571529246, 0.6221401235505469, 0.5983450087061878)]
['넙다리중간둘레', (0.6361874559548978, 0.6312615003846949, 0.6050697500857904)]
['어깨사이길이', (0.6444679351656096, 0.6594364780375332, 0.6598705769807707)]
['허리두께', (0.6499295278365046, 0.645427982381224, 0.6154218201806898)]
['겨드랑뒤벽사이길이', (0.6573291050035236, 0.6719734224397872, 0.6730939825022288)]
['귀구슬사이머리위길이', (0.658738548273432, 0.6619260389873934, 0.6345213949918554)]        
['허리둘레', (0.6668428470754052, 0.6624058493539865, 0.6280593330004557)]
['무릎둘레', (0.6682522903453136, 0.6657353896871896, 0.632028820092571)]
['얼굴수직길이/코뿌리-턱끝수직길이', (0.6703664552501761, 0.666068044928377, 0.6309349688248522)]
['앞중심길이', (0.671599718111346, 0.6683641379722471, 0.6334984075714072)]
['무릎아래둘레', (0.6726568005637773, 0.6685765293799815, 0.63301388491884)]
['넙다리직선길이', (0.6738900634249472, 0.6727520249391834, 0.6387873492826832)]
['허리너비', (0.6763565891472868, 0.6725720026791695, 0.6363287929955985)]
['얼굴너비', (0.6779422128259338, 0.6768612882422805, 0.6421618402804319)]
['앉은엉덩이오금수평길이', (0.682522903453136, 0.6803489394124254, 0.6438991701693088)]      
['장딴지둘레', (0.7052501761804087, 0.7011942970541586, 0.6589208118935702)]
['겨드랑두께', (0.7064834390415786, 0.7013530303747102, 0.657948539036056)]
['종아리최소둘레', (0.7084214235377027, 0.7043557668126598, 0.6615072797394812)]
['앉은넙다리높이', (0.7091261451726568, 0.7046201978501907, 0.6612498048651562)]
['머리둘레', (0.7093023255813954, 0.7060958574960722, 0.6639250095765424)]
['샅앞뒤길이', (0.7114164904862579, 0.7050281736081889, 0.6596875125926241)]
['검지손가락길이', (0.7144115574348132, 0.714360572386129, 0.6753682396285212)]
['엉덩이수직길이', (0.7174066243833686, 0.7156962977164811, 0.6740478152164351)]
['어깨가쪽사이길이', (0.7189922480620154, 0.7304328502030542, 0.7267385695110787)]
['머리너비', (0.7350246652572234, 0.7320541710136771, 0.6865107766101276)]
['(편)위팔둘레', (0.7353770260747005, 0.7341763421369115, 0.6912692445777827)]
['발꿈치너비', (0.7366102889358703, 0.7354406063488349, 0.6924723223109229)]
['앉은엉덩이무릎수평길이', (0.7413671599718111, 0.7381744298672617, 0.6915766241291172)]     
['위팔길이(어깨점)', (0.7447145877378436, 0.7423693469150957, 0.6967208511954083)]
['팔꿈치사이너비', (0.7466525722339676, 0.7437506380457003, 0.6970265115373137)]
['검지손가락끝마디너비', (0.7484143763213531, 0.7423664834904896, 0.6910945592478396)]       
['배꼽수준등길이', (0.7505285412262156, 0.7482452187033914, 0.7021769257865865)]
['목뒤등뼈위겨드랑수준길이', (0.7508809020436927, 0.7498514754106523, 0.7060405267873452)]   
['겨드랑앞벽사이길이', (0.7625088090204369, 0.772142613484987, 0.7680240297832839)]
['머리두께/눈살-뒤통수돌출직선길이', (0.7628611698379141, 0.7597270533866843, 0.7111651859934544)]
['앉은어깨높이', (0.7707892882311487, 0.7688652372783024, 0.7221587578507491)]
['체중(몸무게)', (0.7723749119097957, 0.767774272503405, 0.71587527736253)]
['손목둘레', (0.7732558139534884, 0.7713200636427242, 0.7244801067008254)]
['샅높이', (0.7751937984496124, 0.7733646733081517, 0.7266804768233163)]
['(편)팔꿈치둘레', (0.7769556025369979, 0.7748733245853637, 0.7275658037238861)]
['손바닥직선길이', (0.7797744890768147, 0.7765390907257412, 0.7266684743193167)]
['검지손가락중간마디너비', (0.7841789992952783, 0.784502523548555, 0.7431524705796664)]      
['가쪽복사높이', (0.786293164200141, 0.7833979886309592, 0.7339494233768475)]
['(팔굽힌)팔꿈치주먹수평길이', (0.7866455250176181, 0.7849489687936517, 0.738268898402374)]  
['(팔굽힌)아래팔수평길이', (0.7880549682875264, 0.7854225543241447, 0.7365024648946228)]     
['머리수직길이', (0.7885835095137421, 0.7867356212510925, 0.7396554021696982)]
['다리가쪽길이', (0.7896405919661733, 0.7883483517878974, 0.7426541690125952)]
['벽면앞으로뻗은주먹수평길이', (0.7899929527836504, 0.7885358438512314, 0.7424166443568103)] 
['(팔굽힌)위팔수직길이', (0.7947498238195913, 0.7938308139346691, 0.7491570768869198)]       
['발너비', (0.7949260042283298, 0.7925426463521216, 0.7440548093570919)]
['겨드랑둘레', (0.7959830866807611, 0.7938789941660837, 0.7460735816659485)]
['팔길이', (0.7963354474982381, 0.7944718475562538, 0.7472789431684531)]
['엉덩이높이', (0.7982734319943622, 0.7971244992119357, 0.7518584062070872)]
['주먹높이', (0.799506694855532, 0.7985545930575646, 0.7538637369710585)]
['손직선길이', (0.8025017618040874, 0.8008300196455828, 0.7541698889524556)]
['정강뼈위점높이', (0.8033826638477801, 0.8020726214278778, 0.7564361651382298)]
['손두께', (0.8056730091613813, 0.8062578277313959, 0.7666124121234699)]
['앉은오금높이', (0.8062015503875969, 0.8043280040436535, 0.7571538255417342)]
['목둘레', (0.8123678646934461, 0.8194014446599622, 0.8116356025338352)]
['발목최대둘레', (0.8128964059196617, 0.8113543500399635, 0.7652741225256191)]
['몸통세로둘레', (0.8136011275546159, 0.8108449094535342, 0.7613262367846135)]
['앉은무릎높이', (0.8144820295983086, 0.8130640635232075, 0.7674087497611676)]
['등길이', (0.8144820295983086, 0.8131746166123447, 0.7678571274778005)]
['앉은눈높이', (0.8192389006342494, 0.817585161982685, 0.7713815942447385)]
['앉은목뒤높이', (0.8192389006342494, 0.8182669060323642, 0.7742221739445091)]
['위팔사이너비', (0.8220577871740662, 0.8205959907075646, 0.7751124029661313)]
['허리높이', (0.8222339675828048, 0.8212425021849173, 0.7772963888834584)]
['위앞엉덩뼈가시높이', (0.8236434108527132, 0.8227847675770698, 0.7793667548912602)]
['배꼽수준허리높이', (0.8238195912614518, 0.8232101728761482, 0.780655668902612)]
['겨드랑높이', (0.828400281888654, 0.8276190997891026, 0.7847844499363694)]
['손너비/손안쪽가쪽직선길이', (0.8386187455954898, 0.8374232166467056, 0.793882733124454)]   
['앉은키', (0.8417899929527837, 0.8409531967023308, 0.7990116371720662)]
['(팔굽힌)팔꿈치손끝수평길이', (0.8421423537702607, 0.8408458805279657, 0.7972235520182139)] 
['(팔굽힌)팔꿈치높이', (0.8424947145877378, 0.8417888187004037, 0.8004135390630561)]
['발직선길이', (0.8440803382663847, 0.8431300218865238, 0.800970193010571)]
['손둘레', (0.8463706835799859, 0.8460991442095329, 0.8068503956788821)]
['어깨높이', (0.8500704721634954, 0.8491364907361989, 0.8076309874935753)]
['어깨가쪽높이', (0.850246652572234, 0.8493223643421468, 0.8078734882710982)]
['몸통수직길이', (0.8504228329809725, 0.84943453588867, 0.8077513245247261)]
['머리위로뻗은주먹높이', (0.8601127554615927, 0.8588284360472789, 0.8170038001551372)]       
['눈높이', (0.8692741367159972, 0.8682911828931544, 0.8288665189349368)]
['목뒤높이', (0.8694503171247357, 0.8687718647368013, 0.8307223292253585)]
['키', (0.8703312191684285, 0.8697380837962536, 0.8322005163371377)]
['어깨너비', (0.8803735024665257, 0.8791352208696345, 0.8401246585411917)]
['성별', (1.0, 1.0, 1.0)]
```




### 2차 시도

#### 접근

피쳐를 임의 수치의 집합으로 설정하고 학습을 진행해본다.

#### 과정

위 수치 중 정확도가 높은 상위 3개, 5개, 7개, 10개 수치를 피쳐로 선택해 테스트해본다.

3개

```
[Model#01] Acc: 0.903982
[Model#01] ROC-AUC: 0.903342
[Model#01] PR-AUC: 0.871377
```

5개

```
[Model#01] Acc: 0.897287
[Model#01] ROC-AUC: 0.896611
[Model#01] PR-AUC: 0.863156
```

7개

```
[Model#01] Acc: 0.894820
[Model#01] ROC-AUC: 0.894322
[Model#01] PR-AUC: 0.861327
```

10개

```
[Model#01] Acc: 0.909443
[Model#01] ROC-AUC: 0.909141
[Model#01] PR-AUC: 0.880180
```




제공된 모든 수치를 피쳐로 설정했을 때는 다음과 같다.

```
[Model#01] Acc: 0.906801
[Model#01] ROC-AUC: 0.907735
[Model#01] PR-AUC: 0.885492
```


#### 결과

10개 피쳐를 서버에 제출했을 때 결과는 다음과 같다.

```
[2023-12-07 03:07:30] 
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.729902 (Acc: 0.920, ROC-AUC: 0.919, PR-AUC: 0.891)

- Metric: 2.72990200
- Rank: 42
- Score: 50.0
```


단순 수치의 집합으로는 큰 효과를 볼 수 없었고, 상위권의 집합이라고 정확도에 도움이 되지는 않았다.

일단은 단일로 높은 정확도를 높은 수치들 사이에서의 연관관계가 크게 없다.


### 3차 시도

#### 접근

모델을 Gaussian Naive bayes에서 Neural Network로 바꾼다면?

#### 과정

분류 모델을 MLPClassifier, 학습 반복 횟수를 100,000회로 설정하고 테스트

```
self._model = MLPClassifier(max_iter=100000)
```

```
[Model#01] Acc: 0.967230
[Model#01] ROC-AUC: 0.968578
[Model#01] PR-AUC: 0.967863

[Model#01] Acc: 0.952960
[Model#01] ROC-AUC: 0.955236
[Model#01] PR-AUC: 0.957095

[Model#01] Acc: 0.981853
[Model#01] ROC-AUC: 0.981961
[Model#01] PR-AUC: 0.976285
```

Neural Network로 학습을 진행하기 때문에 매 시도마다 값이 다르게 나온다.

결과를 재현하기 위해 random_state 값을 설정해야 하는 것으로 보인다.

0부터 99까지 random_state를 설정하고, max_iter를 100,000으로 설정했을 때 Metric은 다음과 같다.

```
[random_state, metrics]
[47, 1.5914266577361018]
[20, 1.7757870060281313]
[58, 2.115405777320189]
[63, 2.2786336235766913]
[37, 2.3832202723747278]
[42, 2.4119141327975306]
[80, 2.4341659222267493]
[15, 2.4534494306764905]
[49, 2.459089049996132]
[51, 2.5485062710884736]
[14, 2.6128063011473857]
[41, 2.6375273541721858]
[57, 2.6393253298917454]
[5, 2.649644168179099]
[8, 2.649644168179099]
[1, 2.6561649787973542]
[95, 2.671695398063062]
[84, 2.6987071287221984]
[28, 2.7174444842936945]
[10, 2.7354271867896007]
[72, 2.737047401237289]
[12, 2.7419087167719267]
[97, 2.7594907588013995]
[78, 2.761463811952914]
[3, 2.7631432218647314]
[69, 2.766638294862892]
[2, 2.7781451064098595]
[40, 2.8065171369915216]
[11, 2.8086416900482]
[81, 2.850942712612643]
[19, 2.8560950866968486]
[17, 2.8598043539408935]
[79, 2.8620061315679357]
[64, 2.8655292473350578]
[45, 2.8695412627722563]
[7, 2.8698245648496608]
[34, 2.8747181875834658]
[86, 2.878388387868423]
[76, 2.88005333826596]
[23, 2.8805742039802973]
[54, 2.883337892798331]
[16, 2.890180302307996]
[82, 2.891503859776961]
[33, 2.893486470387776]
[29, 2.8936966691473933]
[89, 2.8948206446281732]
[66, 2.899170659933316]
[46, 2.9050484974064443]
[71, 2.9067376368657483]
[85, 2.906867663176252]
[90, 2.907050141836098]
[88, 2.909579824925042]
[87, 2.9106897607496185]
[99, 2.9108703739890225]
[73, 2.9129176515605275]
[36, 2.9154383689630077]
[0, 2.9161403792536666]
[13, 2.9186718885243046]
[59, 2.9196485607200615]
[96, 2.920346409506501]
[25, 2.922836929458939]
[38, 2.923846018790678]
[93, 2.9239491394089843]
[92, 2.9243966203980554]
[30, 2.9283980614330942]
[21, 2.9288995982064754]
[91, 2.9289064038257493]
[26, 2.9289720188369865]
[62, 2.929736389790425]
[75, 2.9297684212751878]
[56, 2.9305293832212578]
[4, 2.930740942293239]
[50, 2.9311823238689447]
[94, 2.931459347382758]
[22, 2.932165974474421]
[68, 2.9327439869022993]
[32, 2.935758227160501]
[39, 2.9383514899479506]
[74, 2.938909566891809]
[6, 2.939360561835511]
[53, 2.9400471300281636]
[70, 2.9403936220737505]
[27, 2.940469565613339]
[43, 2.940549394315417]
[65, 2.9419246120443994]
[67, 2.942212999547329]
[44, 2.942607223355613]
[77, 2.942610418690345]
[9, 2.942837345311551]
[35, 2.9434075933178954]
[83, 2.9436479202048913]
[18, 2.9439035378213836]
[52, 2.9445519327111787]
[98, 2.9446053811726687]
[60, 2.9450452585233307]
[48, 2.9480589952233633]
[24, 2.951880268206607]
[31, 2.9533872398091088]
[61, 2.95527350457486]
[55, 2.95552238744815]
```

가장 metric이 높은 55번 모델을 서버에 제출했을 때 결과는 다음과 같다.

```
[2023-12-07 03:29:09] 
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.950272 (Acc: 0.985, ROC-AUC: 0.985, PR-AUC: 0.980)

- Metric: 2.95027200
- Rank: 22
- Score: 70.0
```


학습 반복 횟수가 metric에 미치는 영향을 확인하기 위해 100회, 1,000회, 10,000회, 100,000회, 1,000,000회로 설정하고 metric의 변화를 확인한다.

100회

```
[random_state, metrics]
...
[83, 2.9436479202048913]
[18, 2.9439035378213836]
[52, 2.9445519327111787]
[98, 2.9446053811726687]
[60, 2.9450452585233307]
[48, 2.9480589952233633]
[24, 2.951880268206607]
[31, 2.9533872398091088]
[61, 2.95527350457486]
[55, 2.95552238744815]
```

1,000회

```
[random_state, metrics]
...
[83, 2.9436479202048913]
[18, 2.9439035378213836]
[52, 2.9445519327111787]
[98, 2.9446053811726687]
[60, 2.9450452585233307]
[48, 2.9480589952233633]
[24, 2.951880268206607]
[31, 2.9533872398091088]
[61, 2.95527350457486]
[55, 2.95552238744815]
```

10,000회

```
[random_state, metrics]
...
[83, 2.9436479202048913]
[18, 2.9439035378213836]
[52, 2.9445519327111787]
[98, 2.9446053811726687]
[60, 2.9450452585233307]
[48, 2.9480589952233633]
[24, 2.951880268206607]
[31, 2.9533872398091088]
[61, 2.95527350457486]
[55, 2.95552238744815]
```

100,000회

```
[random_state, metrics]
...
[83, 2.9436479202048913]
[18, 2.9439035378213836]
[52, 2.9445519327111787]
[98, 2.9446053811726687]
[60, 2.9450452585233307]
[48, 2.9480589952233633]
[24, 2.951880268206607]
[31, 2.9533872398091088]
[61, 2.95527350457486]
[55, 2.95552238744815]
```

1,000,000회

```
[random_state, metrics]
...
[83, 2.9436479202048913]
[18, 2.9439035378213836]
[52, 2.9445519327111787]
[98, 2.9446053811726687]
[60, 2.9450452585233307]
[48, 2.9480589952233633]
[24, 2.951880268206607]
[31, 2.9533872398091088]
[61, 2.95527350457486]
[55, 2.95552238744815]
```

max_iter의 변화가 전혀 영향을 주지 못하고 있다.

시간 절약을 위해 max_iter를 기본값인 200으로 설정하고 진행하기로 했다.

데스크탑에서는 random_state를 0부터, 노트북에서는 random_state를 199,999,999부터 모든 경우를 저장했다.

데스크탑에서 19890개 데이터가 쌓였을 때 metric 상위권 결과는 다음과 같다.

|random_state|metric|ACC|ROC-AUC|PR-AUC|
|---|---|---|---|---|
|9756|2.970969|0.991367|0.991371|0.98823|
|11104|2.966135|0.989605|0.989715|0.986814|
|2147|2.964562|0.989253|0.989325|0.985984|
|5954|2.964185|0.989253|0.989288|0.985643|
|4498|2.963934|0.989429|0.989382|0.985123|
|13888|2.963747|0.988901|0.989009|0.985838|

이 중 1등인 9756번을 서버에 제출했을 때 결과는 다음과 같다.

```
[2023-12-07 14:32:14] 
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.964940 (Acc: 0.989, ROC-AUC: 0.989, PR-AUC: 0.987)

- Metric: 2.96494000
- Rank: 20
- Score: 75.0
```



학습 및 평가 데이터를 정규화한 후 모델에 적용했을 때 결과는 다음과 같다.

|random_state|metric|ACC|ROC-AUC|PR-AUC|
|---|---|---|---|---|
|0|2.963682|0.989077|0.989121|0.985485|
|1|2.962309|0.989253|0.989104|0.983953|
|2|2.963936|0.988901|0.989027|0.986008|
|3|2.964249|0.989605|0.989531|0.985113|
|4|2.957613|0.986082|0.986514|0.985017|
|5|2.962309|0.989253|0.989104|0.983953|
|6|2.961565|0.989253|0.98903|0.983282|
|7|2.964628|0.989077|0.989213|0.986338|
|8|2.966634|0.99031|0.990238|0.986086|
|9|2.959669|0.988196|0.988136|0.983337|

random_state의 영향을 덜 받아 일관성 있는 metric을 출력했다.


Normalizer

```
[Model#01] Acc: 0.987491
[Model#01] ROC-AUC: 0.987835
[Model#01] PR-AUC: 0.986114
[Model#01] Metric: 2.961440
```


```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.955717 (Acc: 0.985, ROC-AUC: 0.986, PR-AUC: 0.984)

- Metric: 2.95571700
- Rank: 29
- Score: 65.0
```


MinMaxScaler

```
[Model#01] Acc: 0.996653
[Model#01] ROC-AUC: 0.996690
[Model#01] PR-AUC: 0.995757
[Model#01] Metric: 2.989099
```

```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.813294 (Acc: 0.935, ROC-AUC: 0.938, PR-AUC: 0.940)

- Metric: 2.81329400
- Rank: 47
- Score: 40.0
```

StandardScaler

```
[Model#01] Acc: 1.000000
[Model#01] ROC-AUC: 1.000000
[Model#01] PR-AUC: 1.000000
[Model#01] Metric: 3.000000
```

```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.992697 (Acc: 0.998, ROC-AUC: 0.998, PR-AUC: 0.997)

- Metric: 2.99269700
- Rank: 5
- Score: 95.0
```


데이터 전처리
- 정규화
- 결측치 = 결측치 없다고 가정
- 특성 선택

하이퍼파라미터 튜닝
- 은닉층 = 그대로 유지
- 뉴런수 = 그대로 유지
- 활성화함수 = ReLU
- 학습률 = 그대로 유지
- 반복횟수 = 500

가장 좋은 결과를 보여주는 random_state = 9756




과적합 문제인 거 같아서 여러 기능을 적용해본다.

Dropout

Dropout 기능을 지원하는 MLPClassicifier의 하위 클래스 코드 [Link](https://datascience.stackexchange.com/questions/117082/how-can-i-implement-dropout-in-scikit-learn)

dropout = 0.7

```
[Model#01] Acc: 0.999823819591
[Model#01] ROC-AUC: 0.999832551909
[Model#01] PR-AUC: 0.999841284227
[Model#01] Metric: 2.999497655727
```

```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.985400 (Acc: 0.996, ROC-AUC: 0.996, PR-AUC: 0.994)

- Metric: 2.98540000
- Rank: 8
- Score: 90.0
```


dropout = 0.1

```
[Model#01] Acc: 1.000000000000
[Model#01] ROC-AUC: 1.000000000000
[Model#01] PR-AUC: 1.000000000000
[Model#01] Metric: 3.000000000000
```

```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.991427 (Acc: 0.997, ROC-AUC: 0.997, PR-AUC: 0.997)

- Metric: 2.99142700
- Rank: 5
- Score: 95.0
```

크게 차이나지 않는다.


은닉층 변환

```
hidden_layer_sizes=[100,100,100]
```


```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.993967 (Acc: 0.998, ROC-AUC: 0.998, PR-AUC: 0.997)

- Metric: 2.99396700
- Rank: 4
- Score: 95.0
```

셔플 비활성화

```
shuffle=False
```

```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.994443 (Acc: 0.998, ROC-AUC: 0.998, PR-AUC: 0.998)

- Metric: 2.99444300
- Rank: 4
- Score: 95.0
```


배치 사이즈 조

```
batch_size = 195
```

```
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.995713 (Acc: 0.999, ROC-AUC: 0.999, PR-AUC: 0.998)

- Metric: 2.99571300
- Rank: 3
- Score: 95.0
```


#### 결과

최종 코드

```python
import numpy as np
import pandas as pd
from sklearn.naive_bayes import GaussianNB
from sklearn.neural_network import MLPClassifier
from sklearn.preprocessing import StandardScaler

class ClassificationModel:
    def __init__(self):
        self._model = None

    @property
    def features(self):
        return self._features

    @features.setter
    def features(self, features):
        self._features = features

    def train(self, df):
        X = df[self._features]
        y = df["성별"]

        scaler = StandardScaler().fit(X)

        # self._model.fit(X, y)

        self._model.fit(scaler.transform(X), y)

    def predict(self, df):
        X = df[self._features]

        scaler = StandardScaler().fit(X)

        # pred = self._model.predict(X)

        pred = self._model.predict(scaler.transform(X))

        return pred


class Model01(ClassificationModel):
    def __init__(self):
        self._model = MLPClassifier(hidden_layer_sizes=[100,100,100],
                                    activation='relu',
                                    solver='adam',
                                    alpha=0.0005,
                                    batch_size=195,
                                    learning_rate='adaptive',
                                    max_iter=500,
                                    shuffle=False,
                                    random_state=9756,
                                    early_stopping=False,
                                    beta_1=0.9,
                                    beta_2=0.999,
                                    epsilon=1e-8
                                    )

        self._features = [
'키',
'눈높이',
'목뒤높이',
'어깨높이',
'어깨가쪽높이',
'겨드랑높이',
'(팔굽힌)팔꿈치높이',
'엉덩이높이',
'주먹높이',
'허리높이',
'배꼽수준허리높이',
'위앞엉덩뼈가시높이',
'정강뼈위점높이',
'샅높이',
'허리너비',
'배꼽수준허리너비',
'엉덩이너비',
'겨드랑두께',
'허리두께',
'배꼽수준허리두께',
'엉덩이두께',
'몸통수직길이',
'엉덩이수직길이',
'체중(몸무게)',
'앞중심길이',
'배꼽수준앞중심길이',
'겨드랑앞벽사이길이',
'겨드랑앞접힘사이길이',
'목둘레',
'목밑둘레',
'허리둘레',
'배꼽수준허리둘레',
'배둘레',
'엉덩이둘레',
'배돌출점기준엉덩이둘레',
'어깨길이',
'목뒤등뼈위겨드랑수준길이',
'등길이',
'배꼽수준등길이',
'넙다리직선길이',
'어깨사이길이',
'어깨가쪽사이길이',
'겨드랑뒤벽사이길이',
'겨드랑뒤접힘사이길이',
'위팔길이(어깨점)',
'팔길이',
'팔안쪽길이',
'겨드랑둘레',
'엉덩이옆길이',
'다리가쪽길이',
'몸통세로둘레',
'샅앞뒤길이',
'배꼽수준샅앞뒤길이',
'앉은키',
'앉은눈높이',
'앉은목뒤높이',
'앉은어깨높이',
'앉은팔꿈치높이',
'앉은넙다리높이',
'앉은무릎높이',
'앉은오금높이',
'앉은엉덩이무릎수평길이',
'앉은엉덩이오금수평길이',
'앉은엉덩이배두께',
'(팔굽힌)위팔수직길이',
'(팔굽힌)아래팔수평길이',
'(팔굽힌)팔꿈치손끝수평길이',
'(팔굽힌)팔꿈치주먹수평길이',
'앉은배두께',
'어깨너비',
'위팔사이너비',
'팔꿈치사이너비',
'앉은엉덩이너비',
'머리수직길이',
'얼굴수직길이/코뿌리-턱끝수직길이',
'벽면앞으로뻗은주먹수평길이',
'벽면어깨수평길이',
'눈동자사이너비',
'눈구석사이너비',
'눈살눈확아래사이수직길이',
'손직선길이',
'손바닥직선길이',
'손너비/손안쪽가쪽직선길이',
'검지손가락길이',
'검지손가락중간마디너비',
'검지손가락끝마디너비',
'손두께',
'막대쥔손안둘레',
'손둘레',
'머리둘레',
'귀구슬사이머리위길이',
'눈살-머리마루-뒤통수길이',
'머리두께/눈살-뒤통수돌출직선길이',
'머리너비',
'얼굴너비',
'아래턱사이너비',
'발너비',
'발직선길이',
'가쪽복사높이',
'넙다리둘레',
'넙다리중간둘레',
'무릎둘레',
'무릎아래둘레',
'장딴지둘레',
'종아리최소둘레',
'발목최대둘레',
'발꿈치너비',
'(편)위팔둘레',
'(편)팔꿈치둘레',
'손목둘레',
'머리위로뻗은주먹높이'
        ]
```

```
[2023-12-07 23:25:37] 
[SECURITY] Checking security issues has passed!
[PROBLEM_01] Testing validation data
Evaluation metric: 2.995713 (Acc: 0.999, ROC-AUC: 0.999, PR-AUC: 0.998)

- Metric: 2.99571300
- Rank: 3
- Score: 95.0
```

## 의문점

- 모두의 Metric이 과도하게 높다
	- scikit-learn에서 neural network 모델을 제공하고 있는 것을 모두가 알고 있는 것 같다
	- 그럼에도 metric의 평균이 2.98~2.99로 과도하게 높다
	- 제공된 평가 데이터에 모두 과적합하고 있는 것이 아닌가

- 제출 모델이 과적합중임을 알면서도 멈추지 못한 이유
	- submission 채널에서 과도하게 올라오는 점수들에 대한 압박
	- 모두가 과열돼서 멈추지 못하는 것이 아닌가
	- 사실 이 과제가 과도한 경쟁사회를 비판하는 교수님의 사회실험일 가능성

- 최종 채점을 위한 평가데이터가 따로 있을 것
	- 그때되면 어떻게 될 지 모르겠다

- 막판 어거지로 점수올리기를 일찍 그만둔 이유
	- 1번 과제에서는 어거지로 점수를 올리는 것이 맞는 방향이었음
		- 실시간 채점을 최종 데이터를 통해 진행
		- 수단과 방법을 가리지 않고 함수를 피팅하는 것이 목적이었으니까
	- 2번 과제에서는 어거지로 점수를 올리는 것이 맞는 방향이 아님
		- 실시간 채점은 이미 제공된 데이터로 진행, 최종 데이터로 채점하는 것이 아님
		- 그렇다면 이 상황에서 어거지로 점수를 올리는 것은 단순 과적합을 증가시키는 것 뿐일테니


## 결과

결국 오버피팅이 맞았다

![Pasted_image_20231212150747.png](/assets/images/Pasted_image_20231212150747.png)


결국 최종 순위는 다른 평가 데이터로 평가됐고

집착 수준으로 오버피팅된 내 모델의 순위가 20등으로 쭉 밀렸다

확신을 가지고 적당한 선에서 멈췄으면 이거보다 더 높은 점수를 기록했을텐데

점수에 대한 불안이 오히려 점수를 깎아먹게 됐다